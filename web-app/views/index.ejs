<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock with - æ ªå¼æŠ•è³‡å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</title>
    <link rel="icon" type="image/png" href="/logo.png">
    <link rel="stylesheet" href="/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <!-- Clerkèªè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        window.Clerk = window.Clerk || {};
        window.Clerk.publishableKey = '<%= publishableKey || "" %>';
    </script>
    <% if (publishableKey) { %>
        <script async crossorigin="anonymous" data-clerk-publishable-key="<%= publishableKey %>"
            src="https://<%= publishableKey.split('_')[1] %>.clerk.accounts.dev/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"></script>
        <% } %>
</head>

<body>

    <style>
        /* General body style for demonstration */
        body {
            margin: 0;
            font-family: sans-serif;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            /* Or your desired max width */
            margin: 0 auto;
            box-sizing: border-box;
            /* Ensures padding doesn't add to width */
        }



        /* Phaseåˆ¥é€²æ—è¡¨ç¤ºã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .phase-progress-container {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border: 1px solid #e2e8f0;
        }

        .phase-progress-title {
            color: #1e40af;
            font-weight: 700;
            font-size: 1.3rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .phase-progress-title i {
            margin-right: 0.5rem;
        }

        .phase-stepper {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 1.5rem;
        }

        .phase-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            position: relative;
            padding: 0.75rem;
            border-radius: 10px;
            transition: all 0.3s ease;
            text-decoration: none;
            color: inherit;
            cursor: pointer;
        }

        .phase-item:hover {
            text-decoration: none;
            color: inherit;
        }

        .phase-item.active {
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(30, 64, 175, 0.3);
        }

        .phase-item.locked {
            background: #f1f5f9;
            color: #64748b;
            opacity: 0.6;
        }

        .phase-item.completed {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .phase-indicator {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .phase-icon {
            position: relative;
            z-index: 2;
            color: inherit;
        }

        .phase-progress-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.3);
            transition: height 0.3s ease;
            border-radius: 0 0 50% 50%;
        }

        .phase-item.active .phase-indicator {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .phase-item.locked .phase-indicator {
            background: #e2e8f0;
            border: 2px solid #cbd5e1;
        }

        .phase-item.completed .phase-indicator {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .phase-name {
            font-size: 0.9rem;
            font-weight: 600;
            margin: 0;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .phase-stepper {
                gap: 1rem;
            }

            .phase-item {
                padding: 0.5rem;
            }

            .phase-indicator {
                width: 45px;
                height: 45px;
                font-size: 1.2rem;
            }

            .phase-name {
                font-size: 0.8rem;
            }
        }

        @media (max-width: 480px) {
            .phase-progress-container {
                padding: 1rem;
                margin: 1rem 0;
            }

            .phase-progress-title {
                font-size: 1.1rem;
                margin-bottom: 0.75rem;
            }

            .phase-stepper {
                gap: 0.5rem;
            }

            .phase-item {
                padding: 0.4rem;
            }

            .phase-indicator {
                width: 40px;
                height: 40px;
                font-size: 1.1rem;
            }

            .phase-name {
                font-size: 0.75rem;
            }
        }

        /* Phase2ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .phase2-button-container {
            text-align: center;
            margin: 3rem 0;
            padding: 2rem 0;
        }

        .phase2-button {
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
            background: linear-gradient(135deg, #1e40af 0%, #3b82f6 100%);
            color: white;
            text-decoration: none;
            padding: 1rem 2rem;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(30, 64, 175, 0.3);
            border: none;
            cursor: pointer;
        }

        .phase2-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(30, 64, 175, 0.4);
            color: white;
            text-decoration: none;
        }

        .phase2-button:active {
            transform: translateY(0);
        }

        .phase2-button i {
            font-size: 1.2rem;
            transition: transform 0.3s ease;
        }

        .phase2-button:hover i {
            transform: translateX(3px);
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .phase2-button-container {
                margin: 2rem 0;
                padding: 1.5rem 0;
            }

            .phase2-button {
                padding: 0.875rem 1.5rem;
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .phase2-button-container {
                margin: 1.5rem 0;
                padding: 1rem 0;
            }

            .phase2-button {
                padding: 0.75rem 1.25rem;
                font-size: 0.95rem;
                gap: 0.5rem;
            }
        }
    </style>

    <%- include('partials/header') %>

        <main class="site-main">
            <div class="container">
                <% if (isGuest) { %>
                    <!-- ã‚²ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰é€šçŸ¥ -->
                    <div class="guest-notice">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>ã‚²ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã§å­¦ç¿’ä¸­</strong><br>
                            å­¦ç¿’é€²æ—ã¯ä¿å­˜ã•ã‚Œã¾ã›ã‚“ã€‚é€²æ—ã‚’ä¿å­˜ã™ã‚‹ã«ã¯<a href="#" onclick="window.Clerk.openSignIn()">ãƒ­ã‚°ã‚¤ãƒ³</a>ã¾ãŸã¯<a href="#"
                                onclick="window.Clerk.openSignUp()">æ–°è¦ç™»éŒ²</a>ã—ã¦ãã ã•ã„ã€‚
                        </div>
                    </div>
                    <% } %>

                        <!-- ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ³¨æ„æ›¸ã -->
                        <div class="prototype-notice">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <strong>ç¾åœ¨ã¯ã¾ã ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆè©¦ä½œæ®µéšï¼‰ã§ã™ï¼</strong><br>
                                ãã®ãŸã‚ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã¨ã—ã¦ã‚‚ã€é€²æ—æ©Ÿèƒ½ãŒä¿å­˜ã•ã‚Œãªã„å ´åˆã‚„ã€çªç„¶ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼ãã®ä»–ã•ã¾ã–ã¾ãªä¸å…·åˆãŒè¦‹ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã”ç†è§£ãã ã•ã„ï¼ï¼
                            </div>
                        </div>

                        <%- include('partials/navigation', { path: '/learning' }) %>


                            <!-- Phaseåˆ¥é€²æ—è¡¨ç¤º -->
                            <div class="phase-progress-container">
                                <h3 class="phase-progress-title">
                                    <i class="fas fa-graduation-cap"></i>å­¦ç¿’ãƒ•ã‚§ãƒ¼ã‚ºé€²æ—
                                </h3>
                                <div class="phase-stepper">
                                    <a href="/learning" class="phase-item active" data-phase="1">
                                        <div class="phase-indicator">
                                            <div class="phase-icon">
                                                <i class="fa-solid fa-seedling"></i>
                                            </div>
                                            <div class="phase-progress-fill" id="phase1-progress-fill"></div>
                                        </div>
                                        <div class="phase-name">Phase 1</div>
                                    </a>

                                    <a href="/phase2" class="phase-item locked" data-phase="2">
                                        <div class="phase-indicator">
                                            <div class="phase-icon">
                                                <i class="fa-solid fa-leaf"></i>
                                            </div>
                                            <div class="phase-progress-fill" style="height: 0%"></div>
                                        </div>
                                        <div class="phase-name">Phase 2</div>
                                    </a>

                                    <a href="/phase3" class="phase-item locked" data-phase="3">
                                        <div class="phase-indicator">
                                            <div class="phase-icon">
                                                <i class="fa-solid fa-tree"></i>
                                            </div>
                                            <div class="phase-progress-fill" style="height: 0%"></div>
                                        </div>
                                        <div class="phase-name">Phase 3</div>
                                    </a>
                                </div>
                            </div>

                            <!-- æ¤œç´¢æ©Ÿèƒ½ -->
                            <!-- <div id="search-container">
                <div id="search-indicator" class="search-indicator">
                    <div class="search-icon">ğŸ”</div>
                    <div class="search-text">æ¤œç´¢</div>
                </div>
                
                <div class="search-form-container hidden">
                    <form action="/search" method="GET" class="search-form">
                        <input type="search" name="q" class="search-input" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ (ä¾‹: NISA, åˆ†æ)">
                        <button type="button" class="btn search-btn" id="search-button">æ¤œç´¢</button>
                    </form>
                </div>
            </div> -->

                            <!-- å­¦ç¿’é€²æ—ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ -->
                            <!-- <div id="stepper-container">
                <div id="progress-indicator" class="progress-indicator">
                    <div class="progress-icon">ğŸ‘£</div>
                    <div class="progress-text">é€²æ—</div>
                </div>
                
                <div class="stepper hidden">
                    <% chapters.forEach((chapter, index) => { %>
                        <div class="stepper-item" data-chapter="<%= index %>">
                            <div class="stepper-indicator clickable" data-chapter="<%= index %>"><%= index + 1 %></div>
                            <div class="stepper-title"><%= chapter.chapter === 0 ? '' : chapter.chapter === 999 ? '' : 'Stage' + chapter.chapter %></div>
                            <div class="stepper-description"><%= chapter.title %></div>
                        </div>
                    <% }); %>
                </div>
            </div> -->

                            <% chapters.forEach((chapter, index)=> { %>
                                <section class="chapter" data-chapter="<%= index %>">
                                    <div class="chapter-header">
                                        <div class="chapter-title-container">
                                            <button class="chapter-toggle" data-chapter="<%= index %>"
                                                aria-expanded="false">
                                                <h2>
                                                    <%= chapter.chapter===0 ? chapter.title : chapter.chapter===999 ?
                                                        chapter.title : 'Stage' + chapter.chapter + ': ' + chapter.title
                                                        %>
                                                </h2>
                                            </button>
                                        </div>
                                        <% if (chapter.totalQuestions> 0) { %>
                                            <div class="progress-container">
                                                <div class="progress-bar"
                                                    data-width="<%= Math.round(chapter.progressPercentage) %>"></div>
                                                <span class="progress-text">
                                                    <%= chapter.clearedQuestions %> / <%= chapter.totalQuestions %> å•ã‚¯ãƒªã‚¢
                                                </span>
                                            </div>
                                            <% } %>
                                    </div>
                                    <div class="chapter-content" id="chapter-<%= index %>" data-visible="false">
                                        <ul class="lesson-list">
                                            <% chapter.lessons.forEach(lesson=> { %>
                                                <li><a href="/lessons/<%= lesson.slug %>" class="lesson-link"
                                                        data-original-title="<%= lesson.title %>">
                                                        <%= lesson.title %>
                                                    </a></li>
                                                <% }); %>
                                        </ul>
                                    </div>
                                </section>
                                <% }); %>

                                    <!-- Phase2ã¸é€²ã‚€ãƒœã‚¿ãƒ³ -->
                                    <div class="phase2-button-container">
                                        <a href="/phase2" class="phase2-button">
                                            <i class="fas fa-arrow-right"></i>
                                            Phase2ã¸é€²ã‚€
                                        </a>
                                    </div>

                                    <!-- æ ªä¾¡åˆ†æãƒ„ãƒ¼ãƒ«ã¸ã®ãƒªãƒ³ã‚¯ -->
                                    <div class="tools-container" style="text-align: center; margin-bottom: 3rem;">
                                        <a href="https://stock-tool-nq6o.onrender.com" target="_blank" class="phase2-button"
                                            style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                                            <i class="fas fa-chart-line"></i>
                                            æ ªä¾¡åˆ†æãƒ„ãƒ¼ãƒ«ã‚’é–‹ã
                                        </a>
                                    </div>
            </div>
        </main>

        <!-- <div class="admin-link-container" style="text-align: center; margin: 20px 0;">
        <a href="/admin/lessons/new" class="btn">ï¼‹ æ–°è¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚’ä½œæˆã™ã‚‹</a>
    </div> -->

        <footer class="site-footer">
            <div class="container">
                <p>&copy; 2025 Stock withæ ªå¼ä¼šç¤¾. All Rights Reserved.</p>
            </div>
        </footer>

        <!-- ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆæ©Ÿèƒ½ï¼ˆä¸€æ™‚çš„ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰ -->
        <!-- <%- include('_chatbot') %> -->
        <!-- <script src="/chatbot.js"></script> -->
        <script>
            // Clerkã®åˆæœŸåŒ–ï¼ˆç°¡ç´ åŒ–ç‰ˆï¼‰
            window.addEventListener('load', async () => {
                try {
                    console.log('ClerkåˆæœŸåŒ–ã‚’é–‹å§‹ã—ã¾ã™...');
                    console.log('Publishable key:', window.Clerk.publishableKey);

                    // ClerkãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
                    if (window.Clerk && typeof window.Clerk.load === 'function') {
                        await window.Clerk.load();
                        console.log('Clerk loaded successfully');
                    } else {
                        console.log('Clerkã¯æ—¢ã«åˆæœŸåŒ–æ¸ˆã¿ã¾ãŸã¯åˆ©ç”¨ã§ãã¾ã›ã‚“');
                    }

                    console.log('Clerk object:', window.Clerk);
                    console.log('Current user:', window.Clerk.user);

                    updateAuthUI();

                    // ãƒ¬ãƒƒã‚¹ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›ï¼ˆStageã‚’å‰Šé™¤ï¼‰
                    formatLessonTitles();

                } catch (error) {
                    console.error('Error loading Clerk:', error);
                    // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ãƒšãƒ¼ã‚¸ã¯ç¶™ç¶š
                    console.log('Clerkã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸãŒã€ãƒšãƒ¼ã‚¸ã¯ç¶™ç¶šã—ã¾ã™');
                }
            });

            // ãƒ¬ãƒƒã‚¹ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›ã™ã‚‹é–¢æ•°
            function formatLessonTitles() {
                const lessonLinks = document.querySelectorAll('.lesson-link');
                lessonLinks.forEach(link => {
                    const originalTitle = link.getAttribute('data-original-title');
                    if (originalTitle) {
                        // "Stage1-1.è¨¼åˆ¸å£åº§ã‚’é–‹è¨­ã—ã‚ˆã†" -> "1-1. è¨¼åˆ¸å£åº§ã‚’é–‹è¨­ã—ã‚ˆã†"
                        // "ã¯ã˜ã‚ã«" -> "ã¯ã˜ã‚ã«" (ãã®ã¾ã¾)
                        const formattedTitle = originalTitle
                            .replace(/^Stage\s*(\d+-\d+)\./, '$1. ')
                            .replace(/^Stage\s*(\d+)\./, '$1. ');
                        link.textContent = formattedTitle;
                    }
                });
            }

            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å‡¦ç†é–¢æ•°
            function handleUserProfile() {
                console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');

            // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            <% if (user) { %>
                    console.log('ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã§ã™');
                    // ClerkãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
                    if (window.Clerk && typeof window.Clerk.openUserProfile === 'function') {
                        try {
                            window.Clerk.openUserProfile();
                            console.log('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»é¢ã‚’é–‹ãã¾ã—ãŸ');
                        } catch (error) {
                            console.error('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»é¢ã‚’é–‹ãéš›ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                            alert('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»é¢ã‚’é–‹ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚');
                        }
                    } else {
                        console.error('ClerkãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                        alert('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚');
                    }
            <% } else { %>
                    console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“');
                    alert('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚');
            <% } %>
        }

            // èªè¨¼UIã®æ›´æ–°é–¢æ•°ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§æ—¢ã«é©åˆ‡ãªçŠ¶æ…‹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ç°¡ç´ åŒ–ï¼‰
            function updateAuthUI() {
                const user = window.Clerk.user;
                const userGreeting = document.getElementById('user-greeting');
                const loginBtn = document.getElementById('login-btn');

                if (user) {
                    // ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆ
                    if (userGreeting) userGreeting.style.display = 'none';
                    if (loginBtn) {
                        loginBtn.innerHTML = '<i class="fas fa-user"></i>';
                        loginBtn.onclick = handleUserProfile;
                    }
                } else {
                    // æœªãƒ­ã‚°ã‚¤ãƒ³ã®å ´åˆ
                    if (userGreeting) userGreeting.style.display = 'none';
                    if (loginBtn) {
                        loginBtn.innerHTML = '<i class="fas fa-right-to-bracket"></i> ãƒ­ã‚°ã‚¤ãƒ³';
                        loginBtn.onclick = () => window.Clerk.openSignIn();
                    }
                }
            }

            // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³æ©Ÿèƒ½ã¨æ¤œç´¢æ©Ÿèƒ½ã®JavaScript
            document.addEventListener('DOMContentLoaded', function () {
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®å¹…ã‚’è¨­å®š
                document.querySelectorAll('.progress-bar').forEach(bar => {
                    const width = bar.getAttribute('data-width');
                    if (width) {
                        bar.style.width = width + '%';
                    }
                });

                // ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®è¡¨ç¤ºçŠ¶æ…‹ã‚’è¨­å®š
                document.querySelectorAll('.chapter-content').forEach(content => {
                    const visible = content.getAttribute('data-visible');
                    if (visible === 'true') {
                        content.style.display = 'block';
                    } else {
                        content.style.display = 'none';
                    }
                });

                // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³æ©Ÿèƒ½
                const chapterToggles = document.querySelectorAll('.chapter-toggle');

                chapterToggles.forEach(toggle => {
                    toggle.addEventListener('click', function () {
                        console.log('Chapter toggle clicked!');
                        const chapterIndex = this.getAttribute('data-chapter');
                        const chapterContent = document.getElementById(`chapter-${chapterIndex}`);
                        const isExpanded = this.getAttribute('aria-expanded') === 'true';

                        console.log('Chapter index:', chapterIndex);
                        console.log('Chapter content element:', chapterContent);
                        console.log('Is expanded:', isExpanded);

                        if (isExpanded) {
                            // é–‰ã˜ã‚‹
                            chapterContent.style.display = 'none';
                            this.setAttribute('aria-expanded', 'false');
                            console.log('Chapter closed');
                        } else {
                            // é–‹ã
                            chapterContent.style.display = 'block';
                            this.setAttribute('aria-expanded', 'true');
                            console.log('Chapter opened');
                        }
                    });
                });

                // é€²æ—ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆStepperã®è¡¨ç¤º/éè¡¨ç¤ºï¼‰
                // const progressIndicator = document.getElementById('progress-indicator');
                // const stepperContainer = document.getElementById('stepper-container');
                // const stepper = document.querySelector('.stepper');

                // progressIndicator.addEventListener('click', function() {
                //     console.log('Progress indicator clicked!');

                //     if (stepper.classList.contains('hidden')) {
                //         // Stepperã‚’è¡¨ç¤º
                //         stepper.classList.remove('hidden');
                //         stepperContainer.classList.add('active');
                //         console.log('Stepper displayed');
                //     } else {
                //         // Stepperã‚’éè¡¨ç¤º
                //         stepper.classList.add('hidden');
                //         stepperContainer.classList.remove('active');
                //         console.log('Stepper hidden');
                //     }
                // });

                // æ¤œç´¢ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤º/éè¡¨ç¤ºï¼‰
                // const searchIndicator = document.getElementById('search-indicator');
                // const searchFormContainer = document.querySelector('.search-form-container');

                // searchIndicator.addEventListener('click', function() {
                //     console.log('Search indicator clicked!');

                //     if (searchFormContainer.classList.contains('hidden')) {
                //         // æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
                //         searchFormContainer.classList.remove('hidden');
                //         console.log('Search form displayed');
                //     } else {
                //         // æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã‚’éè¡¨ç¤º
                //         searchFormContainer.classList.add('hidden');
                //         console.log('Search form hidden');
                //     }
                // });

                // ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
                // const stepperIndicators = document.querySelectorAll('.stepper-indicator.clickable');

                // stepperIndicators.forEach(indicator => {
                //     indicator.addEventListener('click', function() {
                //         console.log('Stepper indicator clicked!');
                //         const chapterIndex = this.getAttribute('data-chapter');
                //         console.log('Chapter index:', chapterIndex);

                //         const targetChapter = document.querySelector(`section.chapter[data-chapter="${chapterIndex}"]`);
                //         console.log('Target chapter found:', targetChapter);

                //         if (targetChapter) {
                //             // å¯¾å¿œã™ã‚‹Chapterã‚’é–‹ã
                //             const chapterToggle = targetChapter.querySelector('.chapter-toggle');
                //             const chapterContent = targetChapter.querySelector('.chapter-content');

                //             if (chapterToggle && chapterContent) {
                //                 // ChapterãŒé–‰ã˜ã¦ã„ã‚‹å ´åˆã¯é–‹ã
                //                 if (chapterContent.style.display === 'none') {
                //                     chapterContent.style.display = 'block';
                //                     chapterToggle.setAttribute('aria-expanded', 'true');
                //                     console.log('Chapter opened');
                //                 }
                //             }

                //             // ç”»é¢ä¸­å¤®ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆã‚ˆã‚Šæ­£ç¢ºãªä½ç½®è¨ˆç®—ï¼‰
                //             const targetRect = targetChapter.getBoundingClientRect();
                //             const windowHeight = window.innerHeight;
                //             const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                //             const targetTop = targetRect.top + scrollTop;
                //             const offset = (windowHeight - targetRect.height) / 2;

                //             console.log('Scroll calculation:', {
                //                 targetRect: targetRect,
                //                 windowHeight: windowHeight,
                //                 scrollTop: scrollTop,
                //                 targetTop: targetTop,
                //                 offset: offset
                //             });

                //             window.scrollTo({
                //                 top: targetTop - offset,
                //                 behavior: 'smooth'
                //             });

                //             console.log('Scrolling to:', targetTop - offset);
                //         } else {
                //             console.log('Target chapter not found!');
                //         }
                //     });
                // });

                // æ¤œç´¢æ©Ÿèƒ½ã®æ”¹å–„
                // const searchForm = document.querySelector('.search-form');
                // const searchBtn = document.getElementById('search-button');
                // const searchInput = document.querySelector('.search-input');

                // console.log('Search elements found:', { searchForm, searchBtn, searchInput });

                // // æ¤œç´¢ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                // if (searchBtn) {
                //     searchBtn.addEventListener('click', function(e) {
                //         console.log('Search button clicked');
                //         e.preventDefault();
                //         e.stopPropagation();
                //         const query = searchInput.value.trim();
                //         console.log('Search query:', query);
                //         if (query) {
                //             window.location.href = `/search?q=${encodeURIComponent(query)}`;
                //         }
                //     });
                // }

                // // Enterã‚­ãƒ¼ã§ã®æ¤œç´¢ï¼ˆæ—¢å­˜ã®å‹•ä½œã‚’ä¿æŒï¼‰
                // if (searchForm) {
                //     searchForm.addEventListener('submit', function(e) {
                //         console.log('Search form submitted');
                //         e.preventDefault();
                //         const query = searchInput.value.trim();
                //         console.log('Search query:', query);
                //         if (query) {
                //             window.location.href = `/search?q=${encodeURIComponent(query)}`;
                //         }
                //     });
                // }

                // ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ã®çŠ¶æ…‹æ›´æ–°
                // function updateStepperProgress() {
                //     const stepperItems = document.querySelectorAll('.stepper-item');
                //     const chapterElements = document.querySelectorAll('.chapter');

                //     // ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ã®çŠ¶æ…‹ã‚’æ›´æ–°ï¼ˆãƒ‡ãƒ¼ã‚¿å±æ€§ã‚’ä½¿ç”¨ï¼‰
                //     stepperItems.forEach((item) => {
                //         const chapterIndex = parseInt(item.getAttribute('data-chapter'));
                //         item.classList.remove('active', 'completed');

                //         // å¯¾å¿œã™ã‚‹Chapterã®é€²æ—çŠ¶æ³ã‚’ç¢ºèª
                //         const chapter = chapterElements[chapterIndex];
                //         if (chapter) {
                //             const progressText = chapter.querySelector('.progress-text');
                //             if (progressText) {
                //                 const match = progressText.textContent.match(/(\d+) \/ (\d+) å•ã‚¯ãƒªã‚¢/);
                //                 if (match) {
                //                     const clearedQuestions = parseInt(match[1]);
                //                     const totalQuestions = parseInt(match[2]);
                //                     if (totalQuestions > 0 && clearedQuestions === totalQuestions) {
                //                         // å…¨å•ã‚¯ãƒªã‚¢ã—ãŸå ´åˆã®ã¿é’è‰²ï¼ˆcompletedï¼‰ã§è¡¨ç¤º
                //                         item.classList.add('completed');
                //                         console.log(`Chapter ${chapterIndex + 1}: completed`);
                //                     } else {
                //                         // æœªå®Œäº†ã®å ´åˆã¯ã‚°ãƒ¬ãƒ¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ã§è¡¨ç¤º
                //                         console.log(`Chapter ${chapterIndex + 1}: incomplete`);
                //                     }
                //                 } else {
                //                     // é€²æ—æƒ…å ±ãŒãªã„å ´åˆã‚‚ã‚°ãƒ¬ãƒ¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ã§è¡¨ç¤º
                //                     console.log(`Chapter ${chapterIndex + 1}: no progress info`);
                //                 }
                //             } else {
                //                 // é€²æ—è¡¨ç¤ºãŒãªã„å ´åˆã‚‚ã‚°ãƒ¬ãƒ¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ã§è¡¨ç¤º
                //                 console.log(`Chapter ${chapterIndex + 1}: no progress display`);
                //             }
                //         }
                //     });

                //     // ç·šã®è‰²ã‚’æ›´æ–°ï¼ˆä¸¡å´ã®Chapterã‚¢ã‚¤ã‚³ãƒ³ãŒé’ã®æ™‚ã®ã¿ç·šã‚’é’ãã™ã‚‹ï¼‰
                //     updateStepperLines();
                // }

                // // ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ã®ç·šã®è‰²ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
                // function updateStepperLines() {
                //     const stepperItems = document.querySelectorAll('.stepper-item');

                //     stepperItems.forEach((item, index) => {
                //         if (index < stepperItems.length - 1) { // æœ€å¾Œã®ã‚¢ã‚¤ãƒ†ãƒ ä»¥å¤–
                //             const currentItem = item;
                //             const nextItem = stepperItems[index + 1];

                //             // ä¸¡å´ã®Chapterã‚¢ã‚¤ã‚³ãƒ³ãŒé’ï¼ˆcompletedï¼‰ã®å ´åˆã®ã¿ç·šã‚’é’ãã™ã‚‹
                //             if (currentItem.classList.contains('completed') && nextItem.classList.contains('completed')) {
                //                 currentItem.style.setProperty('--line-color', 'var(--primary-color)');
                //             } else {
                //                 currentItem.style.setProperty('--line-color', 'var(--border-color)');
                //             }
                //         }
                //     });
                // }

                // // åˆæœŸåŒ–æ™‚ã«ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ã®çŠ¶æ…‹ã‚’æ›´æ–°
                // updateStepperProgress();

                // Phase1ã®é€²æ—ã‚’è¨­å®š
                const phase1ProgressFill = document.getElementById('phase1-progress-fill');
                if (phase1ProgressFill) {
                    phase1ProgressFill.style.height = '<%= phase1Progress %>%';
                }

                // // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šæ¤œç´¢ãƒœã‚¿ãƒ³ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
                // setTimeout(() => {
                //     console.log('Search button element:', document.querySelector('.search-btn'));
                //     console.log('Search button text:', document.querySelector('.search-btn')?.textContent);
                //     console.log('Search button visible:', document.querySelector('.search-btn')?.offsetParent !== null);
                // }, 1000);
            });
        </script>
</body>

</html>