<!DOCTYPE html>
<html lang="ja">

<head>
    <%- include('partials/analytics') %>

        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Stock with - æ ªå¼æŠ•è³‡å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</title>
        <link rel="icon" type="image/png" href="/logo.png">
        <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/style.css">
        <link rel="stylesheet" href="/navbar.css">

        <!-- Clerkèªè¨¼ã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
        <script>
            window.Clerk = window.Clerk || {};
            window.Clerk.publishableKey = '<%= publishableKey || "" %>';
        </script>
        <% if (publishableKey) { %>
            <script async crossorigin="anonymous" data-clerk-publishable-key="<%= publishableKey %>"
                src="https://<%= publishableKey.split('_')[1] %>.clerk.accounts.dev/npm/@clerk/clerk-js@latest/dist/clerk.browser.js"></script>
            <% } %>
</head>

<body>

    <style>
        /* General body style for demonstration */
        body {
            margin: 0;
            font-family: sans-serif;
        }

        .container {
            width: 100%;
            max-width: 1200px;
            /* Or your desired max width */
            margin: 0 auto;
            box-sizing: border-box;
            /* Ensures padding doesn't add to width */
        }
    </style>

    <%- include('partials/header') %>

        <main class="site-main">
            <div class="container">
                <% if (isGuest) { %>
                    <!-- ã‚²ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰é€šçŸ¥ -->
                    <div class="guest-notice">
                        <i class="fas fa-info-circle"></i>
                        <div>
                            <strong>ã‚²ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã§å­¦ç¿’ä¸­</strong><br>
                            å­¦ç¿’é€²æ—ã¯ä¿å­˜ã•ã‚Œã¾ã›ã‚“ã€‚é€²æ—ã‚’ä¿å­˜ã™ã‚‹ã«ã¯<a href="#" onclick="window.Clerk.openSignIn()">ãƒ­ã‚°ã‚¤ãƒ³</a>ã¾ãŸã¯<a href="#"
                                onclick="window.Clerk.openSignUp()">æ–°è¦ç™»éŒ²</a>ã—ã¦ãã ã•ã„ã€‚
                        </div>
                    </div>
                    <% } %>

                        <!-- ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ³¨æ„æ›¸ã -->
                        <div class="prototype-notice">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div>
                                <strong>ç¾åœ¨ã¯ã¾ã ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆè©¦ä½œæ®µéšï¼‰ã§ã™ï¼</strong><br>
                                ãã®ãŸã‚ã€ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã¨ã—ã¦ã‚‚ã€é€²æ—æ©Ÿèƒ½ãŒä¿å­˜ã•ã‚Œãªã„å ´åˆã‚„ã€çªç„¶ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼ãã®ä»–ã•ã¾ã–ã¾ãªä¸å…·åˆãŒè¦‹ã‚‰ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã”ç†è§£ãã ã•ã„ï¼ï¼<br>
                                <br>
                                <strong>ã¾ãŸã€Phase2ä»¥é™ã‚‚ç¾åœ¨é–‹ç™ºä¸­ã§ã™ã®ã§ã€èª²é‡‘ã®éš›ã¯ååˆ†ãŠæ°—ã‚’ã¤ã‘ãã ã•ã„ã€‚</strong>
                            </div>
                        </div>

                        <%- include('partials/navigation', { path: '/learning' }) %>




                            <!-- æ¤œç´¢æ©Ÿèƒ½ -->
                            <!-- <div id="search-container">
                <div id="search-indicator" class="search-indicator">
                    <div class="search-icon">ğŸ”</div>
                    <div class="search-text">æ¤œç´¢</div>
                </div>
                
                <div class="search-form-container hidden">
                    <form action="/search" method="GET" class="search-form">
                        <input type="search" name="q" class="search-input" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã§æ¤œç´¢ (ä¾‹: NISA, åˆ†æ)">
                        <button type="button" class="btn search-btn" id="search-button">æ¤œç´¢</button>
                    </form>
                </div>
            </div> -->

                            <!-- å­¦ç¿’é€²æ—ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ -->
                            <!-- <div id="stepper-container">
                <div id="progress-indicator" class="progress-indicator">
                    <div class="progress-icon">ğŸ‘£</div>
                    <div class="progress-text">é€²æ—</div>
                </div>
                
                <div class="stepper hidden">
                    <% chapters.forEach((chapter, index) => { %>
                        <div class="stepper-item" data-chapter="<%= index %>">
                            <div class="stepper-indicator clickable" data-chapter="<%= index %>"><%= index + 1 %></div>
                            <div class="stepper-title"><%= chapter.chapter === 0 ? '' : chapter.chapter === 999 ? '' : 'Stage' + chapter.chapter %></div>
                            <div class="stepper-description"><%= chapter.title %></div>
                        </div>
                    <% }); %>
                </div>
            </div> -->

                            <% chapters.forEach((chapter, index)=> { %>
                                <% if (chapter.lessons && chapter.lessons.length> 0) { %>
                                    <section class="theme-section">
                                        <div class="theme-header">
                                            <h2 class="theme-title">
                                                <% if (chapter.chapter===0) { %>
                                                    <%= chapter.title %>
                                                        <% } else if (chapter.chapter===999) { %>
                                                            <%= chapter.title %>
                                                                <% } else { %>
                                                                    Stage <%= chapter.chapter %> <span
                                                                            style="font-size: 0.7em; margin-left: 10px; color: #666; font-weight: normal;">
                                                                            <%= chapter.title %>
                                                                        </span>
                                                                        <% } %>
                                                                            <i class="fas fa-chevron-right"
                                                                                style="font-size: 0.8em; margin-left: 0.5rem; color: #64748b;"></i>
                                            </h2>
                                        </div>

                                        <div class="articles-horizontal-scroller">
                                            <% chapter.lessons.forEach(lesson=> { %>
                                                <article class="article-card compact">
                                                    <a href="/lessons/<%= lesson.slug %>" class="article-link">
                                                        <div class="article-thumbnail-wrapper">
                                                            <% if (lesson.thumbnail && lesson.thumbnail.url) { %>
                                                                <img src="<%= lesson.thumbnail.url %>"
                                                                    alt="<%= lesson.title %>" class="article-thumbnail"
                                                                    style="object-fit: contain; background-color: #f1f5f9;">
                                                                <% } else { %>
                                                                    <div
                                                                        style="width: 100%; height: 100%; background: linear-gradient(135deg, #f1f5f9 0%, #cbd5e1 100%); display: flex; align-items: center; justify-content: center;">
                                                                        <i class="fas fa-book-open"
                                                                            style="font-size: 3rem; color: #94a3b8;"></i>
                                                                    </div>
                                                                    <% } %>
                                                        </div>

                                                        <div class="article-content"
                                                            style="display: flex; flex-direction: column; flex-grow: 1;">
                                                            <h3 class="article-title">
                                                                <%= lesson.title %>
                                                            </h3>

                                                            <div class="article-description"
                                                                style="font-size: 0.8em; color: #64748b; margin-bottom: 0.5rem; flex-grow: 1;">
                                                                <!-- Description if available, or just space -->
                                                            </div>

                                                            <div class="article-meta" style="margin-top: auto;">
                                                                <span class="article-date">
                                                                    <i class="fas fa-question-circle"></i>
                                                                    <%= lesson.questions ? lesson.questions.length : 0
                                                                        %>å•
                                                                </span>

                                                                <% const isCleared=lesson.questions &&
                                                                    lesson.questions.length> 0 &&
                                                                    clearedQuestionIds && lesson.questions.every(q =>
                                                                    clearedQuestionIds.has(q.id));
                                                                    const clearedCount = lesson.questions &&
                                                                    clearedQuestionIds ? lesson.questions.filter(q =>
                                                                    clearedQuestionIds.has(q.id)).length : 0;
                                                                    %>

                                                                    <% if (isCleared) { %>
                                                                        <span class="badge badge-paid"
                                                                            style="background-color: #10b981; color: white; padding: 0.25em 0.6em; border-radius: 999px; font-size: 0.75em;">CLEAR</span>
                                                                        <% } else if (clearedCount> 0) { %>
                                                                            <span class="badge badge-free"
                                                                                style="background-color: #f59e0b; color: white; padding: 0.25em 0.6em; border-radius: 999px; font-size: 0.75em;">æŒ‘æˆ¦ä¸­</span>
                                                                            <% } else { %>
                                                                                <span class="badge badge-free"
                                                                                    style="background-color: #94a3b8; color: white; padding: 0.25em 0.6em; border-radius: 999px; font-size: 0.75em;">æœªå®Œäº†</span>
                                                                                <% } %>
                                                            </div>
                                                        </div>
                                                    </a>
                                                </article>
                                                <% }); %>
                                        </div>
                                    </section>
                                    <% } %>
                                        <% }); %>



                                            <!-- æ ªä¾¡åˆ†æãƒ„ãƒ¼ãƒ«ã¸ã®ãƒªãƒ³ã‚¯ -->
                                            <div class="tools-container"
                                                style="text-align: center; margin-bottom: 3rem;">
                                                <a href="https://stock-tool-nq6o.onrender.com" target="_blank"
                                                    class="phase2-button"
                                                    style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                                                    <i class="fas fa-chart-line"></i>
                                                    æ ªä¾¡åˆ†æãƒ„ãƒ¼ãƒ«ã‚’é–‹ã
                                                </a>
                                            </div>
            </div>
        </main>

        <!-- <div class="admin-link-container" style="text-align: center; margin: 20px 0;">
        <a href="/admin/lessons/new" class="btn">ï¼‹ æ–°è¦ãƒ¬ãƒƒã‚¹ãƒ³ã‚’ä½œæˆã™ã‚‹</a>
    </div> -->

        <%- include('partials/global-footer', { isHome: false }) %>

            <!-- ãƒãƒ£ãƒƒãƒˆãƒœãƒƒãƒˆæ©Ÿèƒ½ï¼ˆä¸€æ™‚çš„ã«ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰ -->
            <!-- <%- include('_chatbot') %> -->
            <!-- <script src="/chatbot.js"></script> -->
            <script>
                // Clerkã®åˆæœŸåŒ–ï¼ˆç°¡ç´ åŒ–ç‰ˆï¼‰
                window.addEventListener('load', async () => {
                    try {
                        console.log('ClerkåˆæœŸåŒ–ã‚’é–‹å§‹ã—ã¾ã™...');
                        console.log('Publishable key:', window.Clerk.publishableKey);

                        // ClerkãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
                        if (window.Clerk && typeof window.Clerk.load === 'function') {
                            await window.Clerk.load();
                            console.log('Clerk loaded successfully');
                        } else {
                            console.log('Clerkã¯æ—¢ã«åˆæœŸåŒ–æ¸ˆã¿ã¾ãŸã¯åˆ©ç”¨ã§ãã¾ã›ã‚“');
                        }

                        console.log('Clerk object:', window.Clerk);
                        console.log('Current user:', window.Clerk.user);

                        updateAuthUI();

                        // ãƒ¬ãƒƒã‚¹ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›ï¼ˆStageã‚’å‰Šé™¤ï¼‰
                        formatLessonTitles();

                    } catch (error) {
                        console.error('Error loading Clerk:', error);
                        // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ãƒšãƒ¼ã‚¸ã¯ç¶™ç¶š
                        console.log('Clerkã®åˆæœŸåŒ–ã«å¤±æ•—ã—ã¾ã—ãŸãŒã€ãƒšãƒ¼ã‚¸ã¯ç¶™ç¶šã—ã¾ã™');
                    }
                });

                // ãƒ¬ãƒƒã‚¹ãƒ³ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›ã™ã‚‹é–¢æ•°
                function formatLessonTitles() {
                    const lessonLinks = document.querySelectorAll('.lesson-link');
                    lessonLinks.forEach(link => {
                        const originalTitle = link.getAttribute('data-original-title');
                        if (originalTitle) {
                            // "Stage1-1.è¨¼åˆ¸å£åº§ã‚’é–‹è¨­ã—ã‚ˆã†" -> "1-1. è¨¼åˆ¸å£åº§ã‚’é–‹è¨­ã—ã‚ˆã†"
                            // "ã¯ã˜ã‚ã«" -> "ã¯ã˜ã‚ã«" (ãã®ã¾ã¾)
                            const formattedTitle = originalTitle
                                .replace(/^Stage\s*(\d+-\d+)\./, '$1. ')
                                .replace(/^Stage\s*(\d+)\./, '$1. ');
                            link.textContent = formattedTitle;
                        }
                    });
                }

                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å‡¦ç†é–¢æ•°
                function handleUserProfile() {
                    console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ');

            // ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯
            <% if (user) { %>
                        console.log('ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã§ã™');
                        // ClerkãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
                        if (window.Clerk && typeof window.Clerk.openUserProfile === 'function') {
                            try {
                                window.Clerk.openUserProfile();
                                console.log('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»é¢ã‚’é–‹ãã¾ã—ãŸ');
                            } catch (error) {
                                console.error('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»é¢ã‚’é–‹ãéš›ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                                alert('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»é¢ã‚’é–‹ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚');
                            }
                        } else {
                            console.error('ClerkãŒåˆ©ç”¨ã§ãã¾ã›ã‚“');
                            alert('ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ©Ÿèƒ½ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚');
                        }
            <% } else { %>
                        console.log('ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã¾ã›ã‚“');
                        alert('ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚');
            <% } %>
        }

                // èªè¨¼UIã®æ›´æ–°é–¢æ•°ï¼ˆã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§æ—¢ã«é©åˆ‡ãªçŠ¶æ…‹ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ç°¡ç´ åŒ–ï¼‰
                function updateAuthUI() {
                    const user = window.Clerk.user;
                    const userGreeting = document.getElementById('user-greeting');
                    const loginBtn = document.getElementById('login-btn');

                    if (user) {
                        // ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆ
                        if (userGreeting) userGreeting.style.display = 'none';
                        if (loginBtn) {
                            loginBtn.innerHTML = '<i class="fas fa-user"></i>';
                            loginBtn.onclick = handleUserProfile;
                        }
                    } else {
                        // æœªãƒ­ã‚°ã‚¤ãƒ³ã®å ´åˆ
                        if (userGreeting) userGreeting.style.display = 'none';
                        if (loginBtn) {
                            loginBtn.innerHTML = '<i class="fas fa-right-to-bracket"></i> ãƒ­ã‚°ã‚¤ãƒ³';
                            loginBtn.onclick = () => window.Clerk.openSignIn();
                        }
                    }
                }

                // ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³æ©Ÿèƒ½ã¨æ¤œç´¢æ©Ÿèƒ½ã®JavaScript
                document.addEventListener('DOMContentLoaded', function () {
                    // Phase1ã®é€²æ—ãƒãƒ¼ã‚’æ›´æ–°
                    const phase1Fill = document.getElementById('phase1-progress-fill');
                    if (phase1Fill) {
                        // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰æ¸¡ã•ã‚ŒãŸé€²æ—ç‡ã‚’é©ç”¨
                        phase1Fill.style.height = '<%= phase1Progress %>%';
                    }

                    // é€²æ—ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆStepperã®è¡¨ç¤º/éè¡¨ç¤ºï¼‰
                    // const progressIndicator = document.getElementById('progress-indicator');
                    // const stepperContainer = document.getElementById('stepper-container');
                    // const stepper = document.querySelector('.stepper');

                    // progressIndicator.addEventListener('click', function() {
                    //     console.log('Progress indicator clicked!');

                    //     if (stepper.classList.contains('hidden')) {
                    //         // Stepperã‚’è¡¨ç¤º
                    //         stepper.classList.remove('hidden');
                    //         stepperContainer.classList.add('active');
                    //         console.log('Stepper displayed');
                    //     } else {
                    //         // Stepperã‚’éè¡¨ç¤º
                    //         stepper.classList.add('hidden');
                    //         stepperContainer.classList.remove('active');
                    //         console.log('Stepper hidden');
                    //     }
                    // });

                    // æ¤œç´¢ã‚¢ã‚¤ã‚³ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆæ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã®è¡¨ç¤º/éè¡¨ç¤ºï¼‰
                    // const searchIndicator = document.getElementById('search-indicator');
                    // const searchFormContainer = document.querySelector('.search-form-container');

                    // searchIndicator.addEventListener('click', function() {
                    //     console.log('Search indicator clicked!');

                    //     if (searchFormContainer.classList.contains('hidden')) {
                    //         // æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
                    //         searchFormContainer.classList.remove('hidden');
                    //         console.log('Search form displayed');
                    //     } else {
                    //         // æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ ã‚’éè¡¨ç¤º
                    //         searchFormContainer.classList.add('hidden');
                    //         console.log('Search form hidden');
                    //     }
                    // });

                    // ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
                    // const stepperIndicators = document.querySelectorAll('.stepper-indicator.clickable');

                    // stepperIndicators.forEach(indicator => {
                    //     indicator.addEventListener('click', function() {
                    //         console.log('Stepper indicator clicked!');
                    //         const chapterIndex = this.getAttribute('data-chapter');
                    //         console.log('Chapter index:', chapterIndex);

                    //         const targetChapter = document.querySelector(`section.chapter[data-chapter="${chapterIndex}"]`);
                    //         console.log('Target chapter found:', targetChapter);

                    //         if (targetChapter) {
                    //             // å¯¾å¿œã™ã‚‹Chapterã‚’é–‹ã
                    //             const chapterToggle = targetChapter.querySelector('.chapter-toggle');
                    //             const chapterContent = targetChapter.querySelector('.chapter-content');

                    //             if (chapterToggle && chapterContent) {
                    //                 // ChapterãŒé–‰ã˜ã¦ã„ã‚‹å ´åˆã¯é–‹ã
                    //                 if (chapterContent.style.display === 'none') {
                    //                     chapterContent.style.display = 'block';
                    //                     chapterToggle.setAttribute('aria-expanded', 'true');
                    //                     console.log('Chapter opened');
                    //                 }
                    //             }

                    //             // ç”»é¢ä¸­å¤®ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ï¼ˆã‚ˆã‚Šæ­£ç¢ºãªä½ç½®è¨ˆç®—ï¼‰
                    //             const targetRect = targetChapter.getBoundingClientRect();
                    //             const windowHeight = window.innerHeight;
                    //             const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                    //             const targetTop = targetRect.top + scrollTop;
                    //             const offset = (windowHeight - targetRect.height) / 2;

                    //             console.log('Scroll calculation:', {
                    //                 targetRect: targetRect,
                    //                 windowHeight: windowHeight,
                    //                 scrollTop: scrollTop,
                    //                 targetTop: targetTop,
                    //                 offset: offset
                    //             });

                    //             window.scrollTo({
                    //                 top: targetTop - offset,
                    //                 behavior: 'smooth'
                    //             });

                    //             console.log('Scrolling to:', targetTop - offset);
                    //         } else {
                    //             console.log('Target chapter not found!');
                    //         }
                    //     });
                    // });

                    // æ¤œç´¢æ©Ÿèƒ½ã®æ”¹å–„
                    // const searchForm = document.querySelector('.search-form');
                    // const searchBtn = document.getElementById('search-button');
                    // const searchInput = document.querySelector('.search-input');

                    // console.log('Search elements found:', { searchForm, searchBtn, searchInput });

                    // // æ¤œç´¢ãƒœã‚¿ãƒ³ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆ
                    // if (searchBtn) {
                    //     searchBtn.addEventListener('click', function(e) {
                    //         console.log('Search button clicked');
                    //         e.preventDefault();
                    //         e.stopPropagation();
                    //         const query = searchInput.value.trim();
                    //         console.log('Search query:', query);
                    //         if (query) {
                    //             window.location.href = `/search?q=${encodeURIComponent(query)}`;
                    //         }
                    //     });
                    // }

                    // // Enterã‚­ãƒ¼ã§ã®æ¤œç´¢ï¼ˆæ—¢å­˜ã®å‹•ä½œã‚’ä¿æŒï¼‰
                    // if (searchForm) {
                    //     searchForm.addEventListener('submit', function(e) {
                    //         console.log('Search form submitted');
                    //         e.preventDefault();
                    //         const query = searchInput.value.trim();
                    //         console.log('Search query:', query);
                    //         if (query) {
                    //             window.location.href = `/search?q=${encodeURIComponent(query)}`;
                    //         }
                    //     });
                    // }

                    // ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ã®çŠ¶æ…‹æ›´æ–°
                    // function updateStepperProgress() {
                    //     const stepperItems = document.querySelectorAll('.stepper-item');
                    //     const chapterElements = document.querySelectorAll('.chapter');

                    //     // ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ã®çŠ¶æ…‹ã‚’æ›´æ–°ï¼ˆãƒ‡ãƒ¼ã‚¿å±æ€§ã‚’ä½¿ç”¨ï¼‰
                    //     stepperItems.forEach((item) => {
                    //         const chapterIndex = parseInt(item.getAttribute('data-chapter'));
                    //         item.classList.remove('active', 'completed');

                    //         // å¯¾å¿œã™ã‚‹Chapterã®é€²æ—çŠ¶æ³ã‚’ç¢ºèª
                    //         const chapter = chapterElements[chapterIndex];
                    //         if (chapter) {
                    //             const progressText = chapter.querySelector('.progress-text');
                    //             if (progressText) {
                    //                 const match = progressText.textContent.match(/(\d+) \/ (\d+) å•ã‚¯ãƒªã‚¢/);
                    //                 if (match) {
                    //                     const clearedQuestions = parseInt(match[1]);
                    //                     const totalQuestions = parseInt(match[2]);
                    //                     if (totalQuestions > 0 && clearedQuestions === totalQuestions) {
                    //                         // å…¨å•ã‚¯ãƒªã‚¢ã—ãŸå ´åˆã®ã¿é’è‰²ï¼ˆcompletedï¼‰ã§è¡¨ç¤º
                    //                         item.classList.add('completed');
                    //                         console.log(`Chapter ${chapterIndex + 1}: completed`);
                    //                     } else {
                    //                         // æœªå®Œäº†ã®å ´åˆã¯ã‚°ãƒ¬ãƒ¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ã§è¡¨ç¤º
                    //                         console.log(`Chapter ${chapterIndex + 1}: incomplete`);
                    //                     }
                    //                 } else {
                    //                     // é€²æ—æƒ…å ±ãŒãªã„å ´åˆã‚‚ã‚°ãƒ¬ãƒ¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ã§è¡¨ç¤º
                    //                     console.log(`Chapter ${chapterIndex + 1}: no progress info`);
                    //                 }
                    //             } else {
                    //                 // é€²æ—è¡¨ç¤ºãŒãªã„å ´åˆã‚‚ã‚°ãƒ¬ãƒ¼ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰ã§è¡¨ç¤º
                    //                 console.log(`Chapter ${chapterIndex + 1}: no progress display`);
                    //             }
                    //         }
                    //     });

                    //     // ç·šã®è‰²ã‚’æ›´æ–°ï¼ˆä¸¡å´ã®Chapterã‚¢ã‚¤ã‚³ãƒ³ãŒé’ã®æ™‚ã®ã¿ç·šã‚’é’ãã™ã‚‹ï¼‰
                    //     updateStepperLines();
                    // }

                    // // ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ã®ç·šã®è‰²ã‚’æ›´æ–°ã™ã‚‹é–¢æ•°
                    // function updateStepperLines() {
                    //     const stepperItems = document.querySelectorAll('.stepper-item');

                    //     stepperItems.forEach((item, index) => {
                    //         if (index < stepperItems.length - 1) { // æœ€å¾Œã®ã‚¢ã‚¤ãƒ†ãƒ ä»¥å¤–
                    //             const currentItem = item;
                    //             const nextItem = stepperItems[index + 1];

                    //             // ä¸¡å´ã®Chapterã‚¢ã‚¤ã‚³ãƒ³ãŒé’ï¼ˆcompletedï¼‰ã®å ´åˆã®ã¿ç·šã‚’é’ãã™ã‚‹
                    //             if (currentItem.classList.contains('completed') && nextItem.classList.contains('completed')) {
                    //                 currentItem.style.setProperty('--line-color', 'var(--primary-color)');
                    //             } else {
                    //                 currentItem.style.setProperty('--line-color', 'var(--border-color)');
                    //             }
                    //         }
                    //     });
                    // }

                    // // åˆæœŸåŒ–æ™‚ã«ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ã®çŠ¶æ…‹ã‚’æ›´æ–°
                    // updateStepperProgress();

                    // Phase1ã®é€²æ—ã‚’è¨­å®š
                    const phase1ProgressFill = document.getElementById('phase1-progress-fill');
                    if (phase1ProgressFill) {
                        phase1ProgressFill.style.height = '<%= phase1Progress %>%';
                    }

                    // // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šæ¤œç´¢ãƒœã‚¿ãƒ³ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
                    // setTimeout(() => {
                    //     console.log('Search button element:', document.querySelector('.search-btn'));
                    //     console.log('Search button text:', document.querySelector('.search-btn')?.textContent);
                    //     console.log('Search button visible:', document.querySelector('.search-btn')?.offsetParent !== null);
                    // }, 1000);
                });
            </script>
</body>

</html>